<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link href="../styles/styleblog.css" rel="stylesheet">
    <link href="../styles/styleventana.css" rel="stylesheet"> -->
    <title>Sistema de Contador y Datos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 0 auto;
            padding: 5px;
        }

        .container {
            border: 1px solid #219c08;
            padding: 5px;
            border-radius: 5px;
            margin-bottom: 20px;
            margin-top: 10px;
        }

        input[type="number"] {
            width: 80%;
            padding: 2px;
            box-sizing: border-box;
        }

        button {
            padding: 10px 15px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
        }

        button:hover {
            background-color: #45a049;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .resultado {
            font-weight: bold;
            margin-top: 15px;
            font-size: 18px;
        }

        .contador {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .oculto {
            display: none !important;
        }

        .mensaje-final {
            text-align: center;
            font-size: 24px;
            color: #ff0000;
            margin-top: 30px;
        }

        body {
            font-family: sans-serif;
            margin: 1rem;
            line-height: 1;
            /* PodÃ©s probar con 1.1 o 1 tambiÃ©n */
        }

        #inicio label,
        #inicio input,
        #inicio select {
            line-height: 1.1;
            margin-bottom: 2px;
        }

        select,
        input[type="number"],
        button {
            margin: 0.5rem;
            padding: 0.4rem;
        }

        #canchaSelect {
            width: auto;
            min-width: 150px;
            /* O el valor que te parezca */
            max-width: 200px;
        }

        .gross {
            width: 26px;
            /* Ideal para 2 dÃ­gitos */
            text-align: center;
            padding: 1px;
            overflow: hidden;
        }

        .gross input {
            width: 100%;
            font-size: 12px;
            padding: 1px;
            line-height: 1;
            height: 16px;
            box-sizing: border-box;
            text-align: center;
        }

        .birdie {
            background-color: #e9f356;
            width: 30px;
        }

        .eagle {
            background-color: #4fe2ef;
            width: 30px;
        }

        .bogey {
            background-color: #d7953f;
            width: 30px;
        }

        .double {
            background-color: #f43939;
            width: 30px;
        }

        .triple {
            background-color: #463f3f;
            color: white;
            width: 30px;
        }

        .cargado {
            color: gray;
            font-style: italic;
        }

        /* esto elimina las flechitas que aumentan y disminuyen el numero */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        /*  estilos segun claude */
        /* Estilos generales para la tabla */

        /* Estilos para el contenedor */
        #tarjetaContainer {
            max-width: 100%;
            padding: 8px;
            overflow-x: hidden;
        }

        /* Estilos para pares diferentes */
        .par3 {
            color: #ff8c00;
        }

        /* Naranja para par 3 */
        .par4 {
            color: #3a7734;
        }

        /* Verde para par 4 */
        .par5 {
            color: #0066cc;
        }

        /* Aplica a toda la tabla de resultados*/
        .tablaLinda {
            width: 100%;
            border-collapse: collapse;
            font-family: "Arial", sans-serif;
            font-size: 13px;
        }

        /* Aplica solo a los encabezados (th) */
        .tablaLinda th {
            background-color: #f2f2f2;
            color: #333;
            padding: 4px;
            text-align: center;
            border: 1px solid #ccc;
        }

        /* Aplica a las celdas del cuerpo de la tabla */
        .tablaLinda td {
            padding: 0px 2px;
            border: 1px solid #ccc;
            text-align: center;
            max-height: 15px;
            line-height: 1;
            font-size: 12px;
        }

        /* Opcional: estilo para filas alternas */
        .tablaLinda tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* Estilo para hoyo */
        .tablaLinda td:nth-child(1) {
            width: 25%;
            font-weight: bold;
        }

        /* Estilo para par */
        .tablaLinda td:nth-child(2) {
            width: 25%;
        }

        /* Estilo para hcp */
        .tablaLinda td:nth-child(3) {
            width: 25%;
            color: #666;
        }

        /* Estilo para la columna de golpes (con clase gross) */
        .tablaLinda td.gross {
            width: 25%;
            background-color: #f8f8ff;
            position: relative;
        }

        /* Estilo para input en la columna de golpes */
        .tablaLinda td input.gross {
            width: 50%;
            padding: 2px 2px;
            border: 1px solid #666565;
            border-radius: 1px;
            text-align: center;
            font-size: 13px;
            height: 18px;
        }

        input[type="number"].dos-digitos {
            width: 5ch;
            /* suficiente para 2 dÃ­gitos + algo de espacio */
            text-align: center;
        }

        #totajugadores {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #totajugadores div {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* centra texto del cartel de NPT */
        #pasoNPT {
            /* display: flex; */
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .otraTablaLinda {
            border-collapse: collapse;
            border: 2px solid black;
            letter-spacing: 0px;
            font-size: 0.9rem;
            margin: 0 auto;
        }

        .otraTablaLinda td,
        th {
            border-collapse: collapse;
            border: 1px dotted rgb(71, 69, 69);
            padding: 12px 5px;
            text-align: center;
        }

        .otraTablaLinda th {
            background-color: #c2cff8c9;
        }
    </style>
</head>

<body>
    <h1>Carga de tarjetas</h1>
    <div id="fechaUltima" style="font-size: 13px; display: flex; align-items: center; gap: 5px">
        <label for="ultFecha">Ãšltima:</label>
        <input id="ultFecha" type="text" placeholder="..." disabled />
        <label for="ultNumero">NÂ°</label>
        <input id="ultNumero" type="number" placeholder=".." disabled style="width: 5ch" />
    </div>

    <div id="inicio" style="font-size: 13px">
        <div>
            <label for="fecha">Fecha:</label>
            <input type="date" id="fecha" />
        </div>

        <div id="selecCanchaDiv" style="display: none">
            <label for="canchaSelect">Cancha:</label>
            <select id="canchaSelect"></select>
        </div>

        <div id="totalJugadores" style="display: none; gap: 3px; margin-top: 8px">
            <div id="infoTotalJugDiv">
                <label for="totPersonas">Jugadores:</label>
                <input type="number" id="totPersonas" class="dos-digitos" min="2" max="12" />
            </div>

            <div id="tarjetasOk">
                <label for="totJugadores">Tarjetas:</label>
                <input type="number" id="totJugadores" class="dos-digitos" min="2" max="12" />
            </div>

            <div id="tarjetasNPT">
                <label for="totNPT">NPT:</label>
                <input type="number" id="totNPT" class="dos-digitos" min="0" max="12" />
            </div>
            <button id="validarJugadores">Seguir</button>
        </div>
    </div>

    <!-- Paso 1: SelecciÃ³n de nombre -->
    <div class="container" id="paso1">
        <!-- Contador -->
        <div class="contador" id="contadorDisplay">
            Falta cargar: <span id="contador"></span>
        </div>
        <h4>1. Seleccionar jugador</h4>
        <div style="display: flex; gap: 10px">
            <!-- <div style="margin-bottom: 1em;"> -->
            <div>
                <select id="jugadorSelect">
                    <option value="">Seleccionar</option>
                    <option value="Diegui">Diegui</option>
                    <option value="Edu">Edu</option>
                    <option value="Fer">Fer</option>
                    <option value="Gaby">Gaby</option>
                    <option value="Joaco">Joaco</option>
                    <option value="Juancho">Juancho</option>
                    <option value="Julito">Julito</option>
                    <option value="Negro">Negro</option>
                    <option value="Panza">Panza</option>
                    <option value="Marcos">Marcos</option>
                    <option value="Sensei">Sensei</option>
                    <option value="Torni">Torni</option>
                </select>
            </div>

            <div>
                <button id="btnContinuar" disabled>Cargar</button>
            </div>

            <div>
                <button id="btnNPT" disabled style="display: none">NPT</button>
            </div>
        </div>
    </div>

    <!-- Paso 2: Tabla para ingresar datos -->
    <div class="container oculto" id="paso2"> // carga de golpes
        <form id="tarjetaForm">
            <!-- <h4>Paso 2: Ingresar datos de <span id="nombreSeleccionado"></span></h4> -->

            <div style="display: flex; gap: 20px; align-items: center">
                <button id="btnVolverSinCargar" type="button" style="margin-left: 30px">
                    Volver
                </button>
                <h4>2. Tarjeta de <span id="nombreSeleccionado"></span></h4>

                <div id="handicapContainer" style="font-size: 13px">
                    <label for="handicap">Hcp</label>
                    <input type="number" id="handicap" style="width: 30px; max-height: 20px" />
                </div>
            </div>
            <div>
                <!-- Tarjeta de score (oculta inicialmente) -->
                <div id="tarjetaContainer" style="display: block">
                    <!-- Tabla de scores -->
                    <table id="scoreTable" class="tablaLinda">
                        <thead>
                            <tr>
                                <th>Hoyo</th>
                                <th>Par</th>
                                <th>Hcp</th>
                                <th>Golpes</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div id="totales" style="display: flex; gap: 20px">
                <p>
                    Ida: <span id="totalGross1to9"><strong>0</strong></span>
                </p>
                <p>
                    Vuelta: <span id="totalGross10to18"><strong>0</strong></span>
                </p>
                <p>
                    Gross: <span id="totalGross"><strong>0</strong></span>
                </p>
                <p>
                    Neto: <span id="totalNeto"><strong>0</strong></span>
                </p>
                <p>
                    Hoyos: <span id="totalHoyos"><strong>0</strong></span>
                </p>
            </div>

            <button id="btnCalcular" type="button" style="display: none" disabled>
                Continuar
            </button>
        </form>
    </div>

    <!-- Paso 3: Mostrar resultados -->
    <div class="container oculto" id="pasoNPT"> // aviso para penalizar
        <h4>No presentÃ³ Tarjeta!!!</h4>
        <div>
            <h4>
                El "jugador " <span id="nombreSeleccionadoNPT"></span> no presento
                tarjeta
            </h4>

            <p>Este jugador serÃ¡ castigado</p>

            <button id="btnAplicaNPT">Castigar</button>
            <button id="btnVuelveNPT">Ops!! Corregir!</button>
        </div>
    </div>

    <!-- Paso 3: Mostrar resultados -->
    <div class="container oculto" id="paso3"> // resumen carga del jugador
        <h4>3. Resultados</h4>
        <div>
            <p>Jugador: <strong id="resultadoNombre"></strong></p>

            <div id="totales2" style="display: flex; gap: 20px">
                <p>
                    Ida: <span id="totalGross1to92"><strong>0</strong></span>
                </p>
                <p>
                    Vuelta: <span id="totalGross10to182"><strong>0</strong></span>
                </p>
                <p>
                    Gross: <span id="totalGross2"><strong>0</strong></span>
                </p>
                <p>
                    Neto: <span id="totalNeto2"><strong>0</strong></span>
                </p>
            </div>
            <div style="display: flex; gap: 20px">
                <p>
                    Handicap otorgado: <span id="hcpJugado"><strong></strong></span>
                </p>
                <p>
                    Hcp Bolilla: <span id="hcpBolilla"><strong></strong></span>
                </p>
                <p>
                    Diferencia: <span id="difHandicap"><strong></strong></span>
                </p>
            </div>

            <button id="btnReiniciar">Guardar datos y continuar</button>
        </div>
    </div>

    <div class="container oculto" id="paso4"> // tabla de clasificacion
        <!-- <fieldset id="segundaTabla" style="display: none"> -->
        <fieldset id="segundaTabla">
            <legend>ClasificaciÃ³n</legend>
            <table id="tablaResultados" class="otraTablaLinda" style="max-height: 20px">
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Player</th>
                        <th>Neto</th>
                        <th>Pelotas</th>
                        <th>Puntos</th>
                        <th>NPT</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Las filas serÃ¡n generadas por JavaScript -->
                </tbody>
            </table>
        </fieldset>
    </div>

    <div class="container oculto" id="paso5"> // birdies de la fecha
        <fieldset id="tablaBerdisFS">
            <legend>Birdies de la fecha</legend>
            <table id="tablaBerdis" class="otraTablaLinda" style="max-height: 20px">
                <thead>
                    <tr>
                        <th>Hoyo</th>
                        <th>Player</th>
                        <th>Par</th>
                        <th>Score</th>
                        <th>Hcp</th>
                        <th>â›³</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </fieldset>
    </div>

    <div class="container oculto" id="paso6"> // hoyos negros de la fecha
        <fieldset id="tablaNegroFS">
            <legend>Hoyos negros de la fecha</legend>
            <table id="tablaNegros" class="otraTablaLinda" style="max-height: 20px">
                <thead>
                    <tr>
                        <th>Hoyo</th>
                        <th>Player</th>
                        <th>Par</th>
                        <th>Score</th>
                        <th>Hcp</th>
                        <th>â›³</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </fieldset>
    </div>

    <!-- Mensaje final -->
    <div class="oculto mensaje-final" id="mensajeFinal">
        <p>Se finalizÃ³ la carga.</p>
        <p>Felicitaciones a la HCDT!!!!</p>
        <button onclick="window.location.href='https://bolilla-negra.com.ar'">
            Continuar
        </button>
        <!-- <button onclick="modificarResultados()">Corregir datos</button> -->
        <br />
    </div>

    <script type="module">
        // Variables globales
        let contador; // Inicializamos el contador
        let ultimo;
        let faltaNPT; // para contar ctdd veces carga NPT

        // Elementos DOM
        const contadorElement = document.getElementById("contador");
        const paso1 = document.getElementById("paso1");
        const paso2 = document.getElementById("paso2");
        const paso3 = document.getElementById("paso3");
        const paso4 = document.getElementById("paso4");
        const paso5 = document.getElementById("paso5");
        const paso6 = document.getElementById("paso6");
        const selectNombre = document.getElementById("selectNombre");
        const jugadorSelect = document.getElementById("jugadorSelect");
        const btnContinuar = document.getElementById("btnContinuar");
        const btnCalcular = document.getElementById("btnCalcular");
        const btnReiniciar = document.getElementById("btnReiniciar");
        const nombreSeleccionado = document.getElementById("nombreSeleccionado");
        const resultadoNombre = document.getElementById("resultadoNombre");
        const mensajeFinal = document.getElementById("mensajeFinal");
        const contadorDisplay = document.getElementById("contadorDisplay");
        const tarjetaForm = document.getElementById("tarjetaForm");

        let fec = 0;
        const fecha = document.getElementById("fecha");
        let nuevaFecha = 0;
        let fechaaRegistrar = 0;
        let fechaSinGuiones = 0;
        let fechaParaComparar = 0;
        let fecFullTabla = 0;
        let fechaBerdiNegro = 0;
        const selecCanchaDiv = document.getElementById("selecCanchaDiv");
        const cancha = document.getElementById("canchaSelect");
        const totJugadores = document.getElementById("totJugadores");
        const totalJugDiv = document.getElementById("infoTotalJugDiv");
        let berdiNegro = [];

        let hoyos = [];
        let cargadas = 0;
        let faltan = 0;
        let nombre = "";

        let handicap = 0;
        let handicapBolilla = 0;
        let handicapDiferencia = 0;
        let npt = 0;
        let gross1to9 = 0;
        let gross10to18 = 0;
        let totalGross = 0;
        let totalNeto = 0;

        let valoresGross = [];
        let datosJugadores = [];
        let ctddPelotas = 0;
        let ctddJugadores = 0;

        let tablaBerdis = [];
        let tablaNegros = [];

        let orden = 0; // para sacar y calcular segun la vuelta - se usa p/saber quien gano en empate

        // ðŸš—ðŸššðŸš‹ðŸš€ðŸ³ðŸ§»ðŸš½â›ˆðŸ§»ðŸ§»ðŸ§»

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ðŸ“¢ðŸ“¢ðŸ“¢ funcionInicial ðŸ§»ðŸ§»ðŸ§»ðŸ§»
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        async function funcionInicial() {
            return new Promise((resolve) => {
                paso1.classList.add("oculto");
                paso2.classList.add("oculto");
                paso3.classList.add("oculto");
                paso4.classList.add("oculto");
                paso5.classList.add("oculto");
                paso6.classList.add("oculto");
                pasoNPT.classList.add("oculto");

                buscaUltimaFecha().then((ultimaFecha) => {
                    if (ultimaFecha) {
                        document.getElementById("ultFecha").value =
                            ultimaFecha.textoFecha;
                        document.getElementById("ultNumero").value = ultimaFecha.fec;
                        fec = ultimaFecha.fec;
                        fecFullTabla = ultimaFecha.fechaFull;
                    } else {
                        alert("No se encontrÃ³ ninguna fecha");
                    }
                });

                fecha.addEventListener("change", () => {
                    fechaParaComparar = fecha.value;
                    fechaSinGuiones = fechaParaComparar.split("-").join("");

                    // Obtener nuevaFecha en formato dd-mm
                    const partes = fechaParaComparar.split("-");
                    const nuevaFecha = `${partes[2]}-${partes[1]}`; // dd-mm

                    const dateTabla = formatToDateString(fecFullTabla);
                    const dateTablaSinGuiones = dateTabla.split("-").join("");
                    if (dateTablaSinGuiones >= fechaSinGuiones) {
                        alert("La fecha debe ser mayor a la ultima");
                        document.getElementById("primeraTabla").style.display = "block";
                        return;
                    }
                    fechaaRegistrar = fechaSinGuiones;
                    selecCanchaDiv.style.display = "block";
                });

                function formatToDateString(dateString) {
                    const date = new Date(dateString);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, "0");
                    const day = String(date.getDate()).padStart(2, "0");
                    return `${year}-${month}-${day}`;
                }

                cargarCanchas();

                cancha.addEventListener("change", async () => {
                    if (cancha.value !== "") {
                        infoTotalJugDiv.style.display = "block";
                    } else {
                        infoTotalJugDiv.style.display = "none";
                    }

                    // document.getElementById('canchaSelect').addEventListener('change', async () => {
                    const canchaId = document.getElementById("canchaSelect").value;
                    const res = await fetch(`/api/hoyos/${canchaId}`);
                    hoyos = await res.json();

                    if (!Array.isArray(hoyos)) {
                        alert("No se pudieron cargar los hoyos de esta cancha.");
                        return;
                    }
                    totalJugadores.style.display = "flex";

                    renderTabla();
                });

                document
                    .getElementById("validarJugadores")
                    .addEventListener("click", () => {
                        const personas = parseInt(
                            document.getElementById("totPersonas").value
                        );
                        const valor = parseInt(
                            document.getElementById("totJugadores").value
                        );
                        const NPT = parseInt(document.getElementById("totNPT").value);

                        if (isNaN(personas) || personas < 2 || personas > 12) {
                            alert("El nÃºmero de jugadores debe estar entre 6 y 12.");
                            document.getElementById("totPersonas").focus();
                            return;
                        }

                        if (valor + NPT !== personas) {
                            alert(
                                "PonÃ© bien los nÃºmeros. Tarjetas + NPT tiene que ser igual a Jugadores."
                            );
                            document.getElementById("totJugadores").focus();
                            return;
                        }

                        ctddPelotas = personas;
                        ctddJugadores = personas;
                        faltaNPT = NPT;

                        if (NPT > 0) {
                            document.getElementById("btnNPT").style.display = "block";
                        }

                        // Ocultar el botÃ³n de validaciÃ³n
                        document.getElementById("validarJugadores").style.display =
                            "none";

                        document.getElementById("fecha").disabled = true;
                        document.getElementById("canchaSelect").disabled = true;
                        document.getElementById("totPersonas").disabled = true;
                        document.getElementById("totJugadores").disabled = true;
                        document.getElementById("totNPT").disabled = true;

                        contador = personas;
                        ultimo = personas;

                        document.getElementById("paso1").classList.remove("oculto");
                        document.getElementById("fechaUltima").style.display = "none";

                        resolve();
                    });
            });
        }

        //----------------------------------------------
        // ðŸ¥Ž    iniciarApp
        //----------------------------------------------
        async function iniciarApp() {
            await funcionInicial(); // Espera hasta que el usuario seleccione fecha y cancha
            berdiNegro = await leerDatosBerdiNegro();
            paso1.classList.remove("oculto"); // Muestra paso 1
        }

        //-----------------------------------------------
        // ðŸ§§ðŸ§§  ðŸ§»ðŸ§»ðŸ§»ðŸ§»  iniciarApp   ðŸ§»ðŸ§»ðŸ§»ðŸ§» ðŸ§§ðŸ§§
        //-----------------------------------------------
        await iniciarApp();

        // Actualizar el contador inicial
        contadorElement.textContent = contador;

        // Habilitar o deshabilitar el botÃ³n segÃºn la selecciÃ³n
        jugadorSelect.addEventListener("change", function () {
            if (this.value) {
                btnContinuar.disabled = false;
                btnNPT.disabled = false;
                btnNPT.style.backgroundColor = "red";
            } else {
                btnContinuar.disabled = true;
                btnNPT.disabled = true;
            }
        });

        // prevenir submit/enter en todo el form
        tarjetaForm.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
            }
        });

        //----------------------------------------------
        // ðŸ¥Ž  ðŸ§»ðŸ§»ðŸ§»ðŸ§»  btnContinuar   ðŸ§»ðŸ§»ðŸ§»ðŸ§»
        //----------------------------------------------
        // Para cargar score despuÃ©s de seleccionar nombre
        btnContinuar.addEventListener("click", function () {
            const jugadorSeleccionado = jugadorSelect.value;
            if (!jugadorSeleccionado) {
                alert("Por favor, seleccione un nombre");
                return;
            }
            nombre = jugadorSeleccionado;
            nombreSeleccionado.textContent = nombre; // Mostrar el nombre seleccionado
            // Ocultar paso 1 y mostrar paso 2
            paso1.classList.add("oculto");
            paso2.classList.remove("oculto");
        });

        //----------------------------------------------
        // ðŸ¥Ž  ðŸ§»ðŸ§»ðŸ§»ðŸ§»  btnNPT   ðŸ§»ðŸ§»ðŸ§»ðŸ§»
        //----------------------------------------------
        // muestra pagina con aviso que no presentÃ³
        btnNPT.addEventListener("click", function () {
            const jugadorSeleccionado = jugadorSelect.value;
            if (!jugadorSeleccionado) {
                alert("Por favor, elegi uno....");
                return;
            }
            nombre = jugadorSeleccionado;
            nombreSeleccionadoNPT.textContent = nombre; // Mostrar el nombre seleccionado

            // Ocultar paso 1 y mostrar NPT
            pasoNPT.classList.remove("oculto");
            pasoNPT.style.display = "flex";
            btnAplicaNPT.style.backgroundColor = "red";
            paso1.classList.add("oculto");
        });

        //----------------------------------------------
        // ðŸ¥Ž  ðŸ§»ðŸ§»ðŸ§»ðŸ§»  btnAplicaNPT   ðŸ§»ðŸ§»ðŸ§»ðŸ§»
        //----------------------------------------------
        // Evento para registrar que no presento tarjeta
        btnAplicaNPT.addEventListener("click", function () {
            contador--; // Restar 1 al contador
            contadorElement.textContent = contador;

            const cancha = parseInt(document.getElementById("canchaSelect").value);
            //  Grabar NETOS con 0 y NPT = 1
            let fecnueva = fec + 1;
            let play = nombre;
            let neto = 0;
            let pos = ultimo--;
            let pg = 0;
            let orden = 0;
            let anual = 0;
            let npt = 1;

            const datosNetos = {
                fecnueva,
                play,
                neto,
                pos,
                pg,
                orden,
                anual,
                npt,
                cancha,
            };
            grabarNuevoNeto(datosNetos);
            marcarJugadoresConTarjeta();
            document.getElementById("jugadorSelect").value = "";

            datosJugadores.push({
                nombre: nombre,
                neto: "-",
                orden: pos,
                npt: 1,
            });

            marcarJugadoresConTarjeta();
            pasoNPT.classList.add("oculto");
            paso1.classList.remove("oculto");

            faltaNPT--;
            if (faltaNPT == 0) {
                document.getElementById("btnNPT").style.display = "none";
            }
        });

        //----------------------------------------------
        // ðŸ¥Ž  btnViuelveNPT  -   btnVolverSinCargar
        //----------------------------------------------
        // ðŸ§»ðŸ§»ðŸ§»ðŸ§»  botones de volver    ðŸ§»ðŸ§»ðŸ§»ðŸ§»
        btnVuelveNPT.addEventListener("click", function () {
            pasoNPT.classList.add("oculto");
            paso1.classList.remove("oculto");
        });

        btnVolverSinCargar.addEventListener("click", function () {
            paso2.classList.add("oculto");
            paso1.classList.remove("oculto");
        });

        //-----------------------------------------
        // ðŸ¥Ž  btnCalcular
        //-----------------------------------------
        // ðŸ§»ðŸ§»ðŸ§»ðŸ§»  btnCalcular    ðŸ§»ðŸ§»ðŸ§»ðŸ§»
        // Evento para calcular la suma y mostrar resumen
        btnCalcular.addEventListener("click", function () {
            const tarjetaForm = document.getElementById("tarjetaForm");
            tarjetaForm.addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                }
            });

            // Mostrar resultados
            resultadoNombre.textContent = nombre;
            totalGross1to92.textContent = gross1to9;
            totalGross10to182.textContent = gross10to18;
            totalGross2.textContent = totalGross;
            totalNeto2.textContent = totalNeto;
            totalNeto2.style.fontWeight = "bold";
            totalNeto2.style.fontSize = "18px";

            hcpJugado.textContent = handicap;
            handicapBolilla = totalGross - 72;
            hcpBolilla.textContent = handicapBolilla;
            handicapDiferencia = handicapBolilla - handicap;
            difHandicap.style.fontSize = "18px";
            difHandicap.style.fontWeight = "bold";
            difHandicap.style.color = handicapDiferencia < 0 ? "red" : "black";
            difHandicap.textContent =
                handicapDiferencia < 0
                    ? `â¬‡ï¸ ${handicapDiferencia}`
                    : `âœ… ${handicapDiferencia}`;

            // Ocultar paso 2 y mostrar paso 3
            paso2.classList.add("oculto");
            paso3.classList.remove("oculto");
        });

        //-----------------------------------------
        // ðŸ¥Ž  btnReiniciar
        //-----------------------------------------
        // ðŸ§»ðŸ§»ðŸ§»ðŸ§»  btnReiniciar    ðŸ§»ðŸ§»ðŸ§»ðŸ§»
        // Si hay pendiente, agrega nombre al array datosJugadores,
        //   limpia campos, renderiza la pagina y vuelve a paso1
        // Si no hay pendiente, llama a    terminoDeCargar()
        btnReiniciar.addEventListener("click", async function () {
            contador--; // Restar 1 al contador
            contadorElement.textContent = contador;

            await guardarResultados();

            // Agregar los datos al array si se ha completado al menos un campo
            // calcula el orden
            orden = gross10to18 - (handicap / 2);

            datosJugadores.push({
                nombre: nombre,
                neto: totalNeto || "-",
                orden: orden || "-",
                npt: npt || "-",
            });

            console.table (datosJugadores);

            if (contador > 0) {
                // si es mayor falta cargar datos - Limpiar campos
                document.getElementById("jugadorSelect").value = "";
                document.getElementById("handicap").value = "";
                document.getElementById("totalGross1to9").innerHTML =
                    "<strong>0</strong>";
                document.getElementById("totalGross10to18").innerHTML =
                    "<strong>0</strong>";
                document.getElementById("totalGross").innerHTML =
                    "<strong>0</strong>";
                document.getElementById("totalNeto").innerHTML = "<strong>0</strong>";
                // Limpiar tabla de score
                renderTabla();
                marcarJugadoresConTarjeta();

                // Volver al paso 1
                paso3.classList.add("oculto");
                paso1.classList.remove("oculto");
            } else {
                terminoDeCargar();
            }
        });

        //-----------------------------------------
        // ðŸ¥Ž  terminoDeCargar
        //-----------------------------------------
        function terminoDeCargar() {
            // Ordena por Neto y Orden
            // Calcula orden como ultimos 9 menos 1/2 handicap
            // Asigna ctdd de pelotas
            // Arma tabla de Resultados con neto > 0
            // Graba nuevos netos
            // Completa tabla de Resultados con los que no jugaron
            // Graba neto 0 con los que no jugaron
            // Muestra los berdis del dia
            // Muestra los negros del dia
            // Actualiza ultima fecha

            // Ordenar los datos por el valor de "Neto" y luego por "Orden"

            console.log('entro en terminoDeCargar')

            datosJugadores.sort((a, b) => {
                const netoA = a.neto === "-" ? Infinity : parseInt(a.neto);
                const netoB = b.neto === "-" ? Infinity : parseInt(b.neto);
                const ordenA = a.orden === "-" ? Infinity : parseInt(a.orden);
                const ordenB = b.orden === "-" ? Infinity : parseInt(b.orden);

                if (netoA === netoB) {
                    return ordenA - ordenB;
                }
                return netoA - netoB;
            });

            // Asigna la cantidad de pelotas a cada jugador
            let valor1 = 0;
            let valor2 = 0;

            if (ctddPelotas < 10) {
                valor1 = ctddPelotas - 3;
                valor2 = 2;
            }
            if (ctddPelotas == 10 || ctddPelotas == 11) {
                valor1 = ctddPelotas - 4;
                valor2 = 3;
            }
            if (ctddPelotas == 12) {
                valor1 = 7;
                valor2 = 4;
            }

            const tablaResultados = document
                .getElementById("tablaResultados")
                .getElementsByTagName("tbody")[0];

            let indice = 0;
            // Insertar las filas ordenadas en la tabla de resultados
            datosJugadores.forEach((jugador) => {
                let filaResultado = tablaResultados.insertRow();
                switch (indice) {
                    case 0:
                        jugador.pelotas = valor1;
                        break;
                    case 1:
                        jugador.pelotas = valor2;
                        break;
                    case 2:
                        jugador.pelotas = 1;
                        break;
                    default:
                        jugador.pelotas = 0;
                        break;
                }

                if (jugador.neto > 0) {
                    jugador.orden = indice + 1;
                    jugador.anual = ctddJugadores - indice;
                }

                filaResultado.insertCell(0).textContent = jugador.orden;
                filaResultado.insertCell(1).textContent = jugador.nombre;
                filaResultado.insertCell(2).textContent = jugador.neto;
                filaResultado.insertCell(3).textContent = jugador.pelotas;
                filaResultado.insertCell(4).textContent = jugador.anual;
                filaResultado.insertCell(5).textContent = jugador.npt;

                //  Grabar NETOS
                if (jugador.neto > 0) {
                    // por si hubo NPT
                    let play = jugador.nombre;
                    let neto = jugador.neto;
                    let pos = jugador.orden;
                    let pg = jugador.pelotas;
                    let orden = 0;
                    let anual = jugador.anual;
                    let npt = 0;
                    let fecnueva = fec + 1;
                    const cancha = parseInt(
                        document.getElementById("canchaSelect").value
                    );
                    const datosNetos = {
                        fecnueva,
                        play,
                        neto,
                        pos,
                        pg,
                        orden,
                        anual,
                        npt,
                        cancha,
                    };
                    grabarNuevoNeto(datosNetos);
                }
                indice++;
            });

            // completa tabla netos con los que no jugaron
            const todosLosNombres = [
                "Diegui",
                "Edu",
                "Fer",
                "Gaby",
                "Joaco",
                "Juancho",
                "Julito",
                "Negro",
                "Panza",
                "Presi",
                "Sensei",
                "Torni",
            ];
            // Filtra los que no estÃ¡n en datosJugadores:
            const jugadoresFaltantes = todosLosNombres.filter((nombre) => {
                return !datosJugadores.some((j) => j.nombre === nombre);
            });

            console.table(jugadoresFaltantes);

            let posiciÃ³nFaltantes = 13 - jugadoresFaltantes.length;
            console.log(`posiciÃ³nFaltantes ${posiciÃ³nFaltantes}`);
            jugadoresFaltantes.forEach((nombre) => {
                let play = nombre;
                let neto = 0;
                let pos = posiciÃ³nFaltantes++;
                let pg = 0;
                let orden = 0;
                let anual = 0;
                let npt = 0;
                let fecnueva = fec + 1;
                const cancha = parseInt(
                    document.getElementById("canchaSelect").value
                );
                const datosNetos = {
                    fecnueva,
                    play,
                    neto,
                    pos,
                    pg,
                    orden,
                    anual,
                    npt,
                    cancha,
                };
                grabarNuevoNeto(datosNetos);
            });

            mostrarTablaBerdis();
            // mostrarTablaNegros();
            actualizaUltimaFecha();

            mensajeFinal.classList.add("oculto");
            paso1.classList.add("oculto");
            paso2.classList.add("oculto");
            paso3.classList.add("oculto");
            contadorDisplay.classList.add("oculto");
            paso4.classList.remove("oculto");
            paso5.classList.remove("oculto");
            paso6.classList.remove("oculto");
            mensajeFinal.classList.remove("oculto");

            return;
        }
        //-----------------------------------------
        // ðŸ¥Ž  calcularTotales
        //-----------------------------------------
        function calcularTotales() {
            handicap = parseInt(document.getElementById("handicap").value) || 0;
            if (!handicap > 0) {
                alert("falta informar handicap");
                return;
            }
            const inputsGross = document.querySelectorAll(".gross");

            // Calcular cuÃ¡ntos hoyos tienen valor vÃ¡lido (> 0)
            const hoyosConValor = Array.from(inputsGross).filter((input) => {
                const valor = parseInt(input.value);
                return !isNaN(valor) && valor > 0;
            }).length;

            gross1to9 = 0;
            gross10to18 = 0;
            // Sumar Gross de los hoyos (1-9 y 10-18)
            inputsGross.forEach((input, index) => {
                const valor = parseInt(input.value);
                if (!isNaN(valor) && valor > 0) {
                    if (index < 9) {
                        gross1to9 += valor;
                    } else {
                        gross10to18 += valor;
                    }
                }
            });

            totalGross = gross1to9 + gross10to18;
            totalNeto = totalGross - handicap;
            const totalGrossElem = document.getElementById("totalGross1to9");
            totalGrossElem.textContent = gross1to9;
            totalGrossElem.style.fontSize = "18px";
            totalGrossElem.style.fontWeight = "bold";
            const totalGrossElem2 = document.getElementById("totalGross10to18");
            totalGrossElem2.textContent = gross10to18;
            totalGrossElem2.style.fontSize = "18px";
            totalGrossElem2.style.fontWeight = "bold";
            const totalGrossElem3 = document.getElementById("totalGross");
            totalGrossElem3.textContent = totalGross;
            totalGrossElem3.style.fontSize = "18px";
            totalGrossElem3.style.fontWeight = "bold";
            const totalGrossElem4 = document.getElementById("totalNeto");
            totalGrossElem4.textContent = totalNeto;
            totalGrossElem4.style.fontSize = "20px";
            totalGrossElem4.style.fontWeight = "bold";
            totalGrossElem4.style.color = "red";
            const totalGrossElem5 = document.getElementById("totalHoyos");
            totalGrossElem5.textContent = hoyosConValor;
            totalGrossElem5.style.fontSize = "18px";
            totalGrossElem5.style.fontWeight = "bold";



            // Activar el botÃ³n de guardar si todos los hoyos tienen valores
            const allFieldsFilled = Array.from(inputsGross).every((input) => {
                const value = input.value.trim();
                return value !== "" && Number(value) > 0;
            });

            const validGross = totalGross > 0 && totalNeto > 0;

            const btn2 = document.getElementById("btnCalcular");
            if (allFieldsFilled && validGross) {
                btn2.disabled = false; // âœ… Habilita el botÃ³n
                btn2.style.display = "inline-block";
                // Crear el arreglo con los valores
                valoresGross = Array.from(inputsGross).map((input) =>
                    Number(input.value.trim())
                );
            } else {
                btn2.disabled = true; // âŒ Lo deshabilita si no estÃ¡ todo completo
            }
        }

        //-----------------------------------------
        // ðŸ¥Ž  guardarResultados
        //-----------------------------------------
        // guarda handicap bolilla (handicap)
        // guarda tarjeta completa (tarjetas)
        // calcula berdis (guardar-berdis --> nuevoberdi)
        // actualiza berdi de berdinegros (si handicap > anterior)
        // calcula negros
        // actualiza negros de berdinegros (si handicap < anterior)
        // marca jugadores con tarjeta
        // disminuye ctdd pendiente de carga
        async function guardarResultados() {
            const jugador = document.getElementById("jugadorSelect").value;
            const cancha = parseInt(document.getElementById("canchaSelect").value);
            const fecha = document.getElementById("fecha").value;
            const hcpcancha = parseInt(document.getElementById("handicap").value);
            let gross = totalGross;
            let neto = totalNeto;
            let hcpbolilla = handicapBolilla;
            let fechaKey = fec + 1;

            // âš½âš½âš½âš½ guarda handicap Bolilla âš½âš½âš½âš½âš½âš½
            let body = {
                jugador,
                cancha,
                fecha,
                gross,
                hcpcancha,
                neto,
                hcpbolilla,
                fechaKey,
            };

            if (
                !jugador ||
                cancha == null ||
                fecha == null ||
                gross == null ||
                hcpcancha == null ||
                neto == null ||
                hcpbolilla == null
            ) {
                return res
                    .status(400)
                    .json({ error: "Faltan datos para guardar el handicap" });
            }

            try {
                const response = await fetch("/handicaps", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(body),
                    credentials: "include",
                });

                if (response.ok) {
                } else {
                    const data = await response.json();
                    alert("Error: " + data.error);
                }
            } catch (error) {
                console.error("Error al guardar:", error);
            }

            // âš½âš½âš½âš½ graba tarjeta completa âš½âš½âš½âš½âš½âš½
            let hoyosValores = [];
            for (let i = 0; i < valoresGross.length; i++) {
                const val = valoresGross[i];
                if (isNaN(val)) {
                    alert(`Falta cargar el hoyo ${i + 1}`);
                    return;
                }
                const golpe = Number(val);
                hoyosValores.push({ hoyo: i + 1, golpes: golpe }); // o parseInt(val)
                // console.log(`mando valor val: ${val} con i: ${i}, golpes: ${golpe}`)
            }

            body = {
                jugador,
                fecha,
                cancha,
                handicap: hcpcancha,
                hoyos: hoyosValores,
            };
            console.log(
                `jugador ${jugador}, fecha: ${fecha}, cancha ${cancha}, hcpcancha : ${hcpcancha}, hoyos largo : ${hoyos.length}`
            );
            if (
                !jugador ||
                !fecha ||
                !cancha ||
                hcpcancha == null ||
                hoyos.length === 0 ||
                hoyos.length !== 18
            ) {
                alert("Faltan datos para guardar las tarjetas");
                return;
            }

            try {
                const res = await fetch("/api/tarjetas", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body),
                    credentials: "include",
                });

                if (!res.ok) {
                    throw new Error(
                        `Error del servidor: ${res.status} ${res.statusText}`
                    );
                }
                // alert(res.message || 'Tarjeta grabada');
            } catch (err) {
                console.error("Error al guardar resultados:", err.message);
                console.error("Stack:", err.stack);
                alert(`Error al guardar resultados: ${err.message}`);
                return; // Detener la ejecuciÃ³n si hay error
            }

            // âš½âš½âš½âš½ graba Colapinto âš½âš½âš½âš½âš½âš½
            // let grossColapinto = hcpcancha + hcpcancha * 0.5 + 72;

            // if (gross > grossColapinto) {
            //     let body = {
            //         fecha,
            //         fechaKey,
            //         jugador,
            //         handicap,
            //         gross,
            //     };
            //     try {
            //         const res = await fetch("/colapinto", {
            //             method: "POST",
            //             headers: { "Content-Type": "application/json" },
            //             body: JSON.stringify(body),
            //             credentials: "include",
            //         });

            //         if (!res.ok) {
            //             throw new Error(
            //                 `Error del servidor: ${res.status} ${res.statusText}`
            //             );
            //         }

            //         const data = await res.json(); // ðŸ‘ˆ opcional para usar la respuesta
            //         console.log("Guardado correctamente:", data);
            //     } catch (err) {
            //         console.error("Error al guardar resultados:", err.message);
            //         alert(`Error al guardar resultados: ${err.message}`);
            //         return; // Detener la ejecuciÃ³n si hay error
            //     }
            // }

            // âš½âš½âš½âš½ calcula los birdies âš½âš½âš½âš½âš½âš½
            for (let i = 0; i < valoresGross.length; i++) {
                const val = valoresGross[i];
                const fechakey = fec + 1;
                if (val < hoyos[i].par) {

                    const berdieActual = berdiNegro[i]["berdihcp"];
                    const nuevoBirdie = {
                        fechakey,
                        hoyo: i + 1,
                        par: hoyos[i].par,
                        jugador,
                        golpes: val,
                        handicap,
                        puntos: handicap < 16 ? 1 
                        : handicap <= 25 ? 2 
                        : 4,
                        jugadorantes: berdiNegro[i]["berdiPlayer"],
                        handicapantes: berdieActual,
                    };
                    // Marcar como "ðŸ†" si corresponde
                    if (berdieActual === null || berdieActual < handicap) {
                        nuevoBirdie.ok = "ðŸ†";

                        fetch("/actualizaBerdi", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                hoyo: nuevoBirdie.hoyo,
                                berdiFecha: nuevaFecha,
                                berdiPlayer: nuevoBirdie.jugador,
                                berdihcp: nuevoBirdie.handicap,
                                puntos: nuevoBirdie.puntos,
                            }),
                        })
                            .then((res) => res.json())
                            .then(console.log)
                            .catch(console.error);
                    }

                    // Enviar a la API y guardar en tabla
                    fetch("/guardar-berdis", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(nuevoBirdie),
                    });

                    tablaBerdis.push(nuevoBirdie);
                }
            }

            // âš½âš½âš½âš½ calcula los negros  âš½âš½âš½âš½âš½âš½
            // for (let i = 0; i < valoresGross.length; i++) {
            //     const val = valoresGross[i];
            //     const par = hoyos[i].par;
            //     let limite;

            //     if (handicap < 12) {
            //         limite = par === 3 ? 5 : par === 4 ? 6 : 7;
            //     } else if (handicap < 23) {
            //         limite = par === 3 ? 6 : par === 4 ? 7 : 8;
            //     } else {
            //         limite = par === 3 ? 7 : par === 4 ? 8 : 9;
            //     }

            //     // calcula que proporciÃ³n del hcp le llevo el hoyo y el que mÃ¡s le llevÃ³ es mÃ¡s negro...
            //     const indiceEsteNegro = (valoresGross[i] - par) / handicap;
            //     const indiceViejoNegro =
            //         (berdiNegro[i]["negroScore"] - par) / berdiNegro[i]["negrohcp"];

            //     if (val > limite && indiceEsteNegro > indiceViejoNegro) {
            //         const nuevoNegro = {
            //             jugador,
            //             hoyo: i + 1,
            //             par,
            //             golpes: val,
            //             handicap,
            //         };

            //         // Asegurate de que `fecha` sea un objeto Date
            //         const fechaObj = new Date(fecha);
            //         // Obtener dÃ­a y mes
            //         const numeroDia = fechaObj.getUTCDate();
            //         const numeroMes = fechaObj.getUTCMonth() + 1;

            //         const fechaBerdiNegro = numeroDia + "-" + numeroMes;

            //         const negroActual = berdiNegro[i]["negrohcp"];
            //         if (negroActual === null || negroActual > handicap) {
            //             nuevoNegro.ok = "ðŸ§¥"; // ðŸ‘ˆ agregÃ¡s la propiedad directamente
            //         }

            //         fetch("/actualizaNegro", {
            //             method: "POST",
            //             headers: { "Content-Type": "application/json" },
            //             body: JSON.stringify({
            //                 hoyo: i + 1,
            //                 negroFecha: fec + 1,
            //                 negroPlayer: jugador,
            //                 negroScore: val,
            //                 negrohcp: handicap,
            //             }),
            //         })
            //             .then((res) => res.json())
            //             .then(console.log)
            //             .catch(console.error);
            //     }

            //     if (val > limite) {
            //         const okNG = 0;
            //         const jugadorantesNG = berdiNegro[i].negroPlayer;
            //         const handicapantesNG = berdiNegro[i].handicapantesNG;
            //         const golpesantesNG = berdiNegro[i].golpesantesNG;
            //         if (indiceEsteNegro > indiceViejoNegro) {
            //             const okNG = 1;
            //         }

            //         fetch("/guardar-negros", {
            //             method: "POST",
            //             headers: { "Content-Type": "application/json" },
            //             body: JSON.stringify({
            //                 fechakeyNG: fec + 1,
            //                 hoyoNG: i + 1,
            //                 parNG: par,
            //                 jugadorNG: jugador,
            //                 golpesNG: val,
            //                 handicapNG: handicap,
            //                 jugadorantesNG,
            //                 handicapantesNG,
            //                 golpesantesNG,
            //                 okNG,
            //             }),
            //         });
            //         const nuevoNegro = {
            //             jugador,
            //             hoyo: i + 1,
            //             par,
            //             golpes: val,
            //             handicap,
            //         };
            //         tablaNegros.push(nuevoNegro);
            //     }
            // }
            // // }

            console.table(tablaBerdis);
            console.table(tablaNegros);
            marcarJugadoresConTarjeta();
            // Incrementa contador de jugadores cargados
            cargadas++;
        }

        /*---------------------------------------
            // ðŸ¥Ž  buscaUltimaFecha               
            -----------------------------------------*/
        async function buscaUltimaFecha() {
            try {
                const response = await fetch(`/leerUltimaFecha`);

                if (response.ok) {
                    const data = await response.json();
                    return data; // Devuelve los datos obtenidos si la respuesta es exitosa
                } else {
                    console.error(
                        "Error en la respuesta:",
                        response.status,
                        response.statusText
                    );
                    return null;
                }
            } catch (error) {
                console.error("Error en la solicitud:", error);
                return null;
            }
        }

        //-----------------------------------------------------
        // ðŸ¥Ž  cargarCanchas
        //-----------------------------------------------------
        async function cargarCanchas() {
            const res = await fetch("/api/canchas");
            const data = await res.json();
            const select = document.getElementById("canchaSelect");
            select.innerHTML = "";

            const optInicial = document.createElement("option");
            optInicial.value = "";
            optInicial.textContent = "Seleccionar";
            optInicial.disabled = true;
            optInicial.selected = true;
            select.appendChild(optInicial);

            data.forEach((c) => {
                const opt = document.createElement("option");
                opt.value = c.id;
                opt.textContent = c.nombre;
                select.appendChild(opt);
            });
        }

        //-----------------------------------------
        // ðŸ¥Ž  renderTabla
        //-----------------------------------------
        function renderTabla() {
            const tbody = document.querySelector("#scoreTable tbody");
            tbody.innerHTML = "";

            hoyos.forEach((h) => {
                const tr = document.createElement("tr");

                tr.innerHTML = `
                        <td>${h.hoyo}</td>
                        <td>${h.par}</td>
                        <td>${h.handicap}</td>
                        <td><input type="number" class="gross"></td>
                    `;

                // Agregar el tr a la tabla
                tbody.appendChild(tr);

                // Ahora seleccionamos el input que acabamos de agregar
                const input = tr.querySelector("input.gross");

                // Y le asignamos el evento onchange
                input.addEventListener("change", function () {
                    actualizarColor(this, h.par);
                });
            });

            // âœ… Asociar evento automÃ¡ticamente al cargar
            const inputsGross = document.querySelectorAll(".gross");
            inputsGross.forEach((input) => {
                input.addEventListener("input", calcularTotales);
            });
        }
        /* Cuando usÃ¡s innerHTML, los eventos inline como onchange="..." no funcionan si las funciones estÃ¡n encapsuladas (como en type="module").
            Al agregar los eventListener con JS, trabajÃ¡s en el mismo Ã¡mbito del mÃ³dulo, donde las funciones sÃ­ estÃ¡n accesibles. */

        //-----------------------------------------
        // ðŸ¥Ž  actualizarColor
        //-----------------------------------------
        function actualizarColor(input, par) {
            const valor = parseInt(input.value);
            input.className = "";

            if (!isNaN(valor)) {
                const diff = valor - par;
                input.classList.add("gross");
                if (diff === -2) input.classList.add("eagle");
                else if (diff === -1) input.classList.add("birdie");
                else if (diff === 1) input.classList.add("bogey");
                else if (diff === 2) input.classList.add("double");
                else if (diff > 2) input.classList.add("triple");
            }
        }

        //-----------------------------------------
        // ðŸ¥Ž  marcarJugadoresConTarjeta
        //-----------------------------------------
        async function marcarJugadoresConTarjeta() {
            const fecha = document.getElementById("fecha").value;
            // const fecha = fec + 1;
            const cancha = document.getElementById("canchaSelect").value;
            if (!fecha || !cancha) return;

            try {
                const res = await fetch(
                    `/api/tarjetas/jugadores-cargados?fecha=${fecha}&cancha=${cancha}`
                );
                // const res = await fetch('/leerDatosNetos');
                const cargados = await res.json();
                // const todosNetos = await res.json();
                // const cargados = todosNetos.filter(registro =>
                //     registro.cancha == cancha && registro.fecha == fecha)

                const select = document.getElementById("jugadorSelect");
                Array.from(select.options).forEach((opt) => {
                    opt.classList.remove("cargado");
                    opt.disabled = false;

                    if (cargados.includes(opt.value)) {
                        opt.classList.add("cargado");
                        opt.disabled = true;
                        opt.textContent = `âœ… ${opt.textContent.replace(/^âœ… /, "")}`;
                    } else {
                        opt.textContent = opt.textContent.replace(/^âœ… /, "");
                    }
                });

                if (cargados.includes(select.value)) {
                    select.value = "";
                }
            } catch (err) {
                console.error("Error al marcar jugadores cargados:", err);
            }
        }

        //-----------------------------------------
        // ðŸ¥Ž  mostrarTablaBerdis
        //-----------------------------------------
        function mostrarTablaBerdis() {
            console.log("tabla berdies");
            console.table(tablaBerdis);
            const tabla = document.querySelector("#tablaBerdis tbody");

            // Limpiar contenido anterior, si lo hubiera
            tabla.innerHTML = "";

            tablaBerdis.forEach((registro) => {
                const fila = tabla.insertRow();

                // Insertar celdas en orden: Hoyo, Player, Par, Score, Hcp, OK
                fila.insertCell(0).textContent = registro.hoyo;
                fila.insertCell(1).textContent = registro.jugador;
                fila.insertCell(2).textContent = registro.par;
                fila.insertCell(3).textContent = registro.golpes;
                fila.insertCell(4).textContent = registro.handicap;
                fila.insertCell(5).textContent = registro.ok;
            });
            // localStorage.setItem("tablaBerdis", JSON.stringify(tablaBerdis));
        }

        //-----------------------------------------
        // ðŸ¥Ž  mostrarTablaNegros
        //-----------------------------------------
        // function mostrarTablaNegros() {
        //     console.log("tabla negros");
        //     console.table(tablaNegros);
        //     const tabla = document.querySelector("#tablaNegros tbody");

        //     // Limpiar contenido anterior, si lo hubiera
        //     tabla.innerHTML = "";

        //     tablaNegros.forEach((registro) => {
        //         const fila = tabla.insertRow();

        //         // Insertar celdas en orden: Hoyo, Player, Par, Score, Hcp, OK
        //         fila.insertCell(0).textContent = registro.hoyo;
        //         fila.insertCell(1).textContent = registro.jugador;
        //         fila.insertCell(2).textContent = registro.par;
        //         fila.insertCell(3).textContent = registro.golpes;
        //         fila.insertCell(4).textContent = registro.handicap;
        //         fila.insertCell(5).textContent = registro.ok;
        //     });
        // }

        //-----------------------------------------
        // ðŸ¥Ž  grabarNuevoNeto
        //-----------------------------------------
        async function grabarNuevoNeto(datosNetos) {
            const { fecnueva, play, neto, pos, pg, orden, anual, npt, cancha } =
                datosNetos;

            const body = {
                fecnueva,
                play,
                neto,
                pos,
                pg,
                orden,
                anual,
                npt,
                cancha,
            };

            try {
                const response = await fetch("/grabaNetos", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(body),
                    credentials: "include",
                });

                const result = await response.json();
                if (result.success) {
                    console.log("no hay error en /grabaNetos");
                } else {
                    throw new Error(result.error || "Error desconocido grabar Netos");
                }
            } catch (error) {
                console.log("Error:", error);
                throw error; // Rechaza la promesa en caso de error
            }
        }

        //-----------------------------------------
        // ðŸ¥Ž  leerDatosBerdiNegro
        //-----------------------------------------
        async function leerDatosBerdiNegro() {
            try {
                const response = await fetch(`/leerBerdiNegro`);
                if (response.ok) {
                    const data = await response.json(); // Convertir response a JSON
                    // console.table(data)
                    return data; // Devuelve los datos obtenidos si la respuesta es exitosa
                } else {
                    console.error(
                        "Error en la respuesta:",
                        response.status,
                        response.statusText
                    );
                    return null;
                }
            } catch (error) {
                console.error("Error en la solicitud:", error);
                return null;
            }
        }

        //-----------------------------------------
        // ðŸ¥Ž  actualizaUltimaFecha
        //-----------------------------------------
        async function actualizaUltimaFecha() {
            const fecha = new Date(fechaParaComparar);
            const diasSemana = [
                "domingo",
                "lunes",
                "martes",
                "miÃ©rcoles",
                "jueves",
                "viernes",
                "sÃ¡bado",
            ];

            const meses = [
                "enero",
                "febrero",
                "marzo",
                "abril",
                "mayo",
                "junio",
                "julio",
                "agosto",
                "septiembre",
                "octubre",
                "noviembre",
                "diciembre",
            ];

            const nombreDia = diasSemana[fecha.getUTCDay()];

            // Asegurate de que `fecha` sea un objeto Date
            const fechaObj = new Date(fecha);
            // Obtener dÃ­a y mes
            const numeroDia = fechaObj.getUTCDate();
            const numeroMes = fechaObj.getUTCMonth() + 1;

            const fechaBerdiNegro = numeroDia + "-" + numeroMes;

            const nombreMes = meses[fechaObj.getUTCMonth()];

            const textoFecha = `${nombreDia} ${numeroDia} de ${nombreMes}`;

            const datos = {
                fec,
                nombreDia,
                numeroDia,
                numeroMes,
                textoFecha,
                fechaaRegistrar,
                ctddPelotas,
                ctddJugadores,
            };

            // grabarNuevaFecha(datos);

            const body = {
                fecnueva: fec + 1,
                nombreDia,
                numeroDia,
                numeroMes,
                textoFecha,
                fechaaRegistrar,
                ctddPelotas,
                ctddJugadores,
            };

            try {
                const response = await fetch("/grabaUltimaFecha", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(body),
                    credentials: "include",
                });

                const result = await response.json();
                if (result.success) {
                    console.log("no hay error");
                } else {
                    throw new Error(
                        result.error || "Error desconocido graba ultima fecha"
                    );
                }
            } catch (error) {
                console.log("Error:", error);
                throw error; // Rechaza la promesa en caso de error
            }
        }
    </script>
</body>

</html>