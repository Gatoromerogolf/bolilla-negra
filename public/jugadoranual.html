<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Bolilla Negra - Jugador Año</title>

    <!-- CSS FILES -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/bootstrap-icons.css" rel="stylesheet" />
    <link href="css/apexcharts.css" rel="stylesheet" />
    <link href="css/tooplate-mini-finance.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Abel&family=Barlow+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Courgette&family=Gupter:wght@400;500;700&family=PT+Sans+Narrow:wght@400;700&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Serif:ital,opsz,wght@0,8..144,100..900;1,8..144,100..900&display=swap"
      rel="stylesheet"
    />
    <!--

Tooplate 2135 Mini Finance

https://www.tooplate.com/view/2135-mini-finance

Bootstrap 5 Dashboard Admin Template

-->
  </head>

  <body>
    <header class="navbar sticky-top flex-md-nowrap">
      <div class="col-md-3 col-lg-3 me-0 px-3 fs-6">
        <a class="navbar-brand" href="index.html">
          <img
            src="images/bn.ico"
            alt="Bolilla Negra Icono"
            style="width: 60px; height: 60px; vertical-align: middle"
          />
          <!-- <i class="bi-box"></i> -->
          Bolilla Negra
        </a>
      </div>

      <button
        class="navbar-toggler position-absolute d-md-none collapsed"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#sidebarMenu"
        aria-controls="sidebarMenu"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div
        class="motivational-text ms-lg-3 ms-md-3 me-lg-auto me-md-auto order-2 order-lg-0 order-md-0 p-3 border rounded"
      >
        <p class="mb-0" style="font-size: 14px">
          "Cada golpe es una oportunidad para disfrutar del juego y fortalecer
          la amistad. Aguante Bolilla!"
        </p>
      </div>

      <div class="navbar-nav me-lg-2">
        <div class="nav-item text-nowrap d-flex align-items-center">
          <div class="dropdown ps-3">
            <a
              class="nav-link dropdown-toggle text-center"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              id="navbarLightDropdownMenuLink"
            >
              <i class="bi-bell"></i>
              <span
                class="position-absolute start-100 translate-middle p-1 bg-danger border border-light rounded-circle"
              >
                <span class="visually-hidden">New alerts</span>
              </span>
            </a>

            <ul
              class="dropdown-menu dropdown-menu-lg-end notifications-block-wrap bg-white shadow"
              aria-labelledby="navbarLightDropdownMenuLink"
            >
              <small>Matriculas</small>

              <li class="notifications-block border-bottom pb-2 mb-2">
                <a class="dropdown-item d-flex align-items-center" href="#">
                  <div class="notifications-icon-wrap bg-success">
                    <i class="notifications-icon bi-check-circle-fill"></i>
                  </div>

                  <div class="container">
                    <div class="row">
                      <div class="col">
                        <p>Diegui - 38.534</p>
                        <p>Edu - 93.293</p>
                        <p>Fer - 126.578</p>
                        <p>Gaby - 119.817</p>
                        <p>Joaco - 119.807</p>
                        <p>Juancho - 119.811</p>
                      </div>

                      <div class="col">
                        <p>Julito - 87.561</p>
                        <p>Negro - 136.262</p>
                        <p>Panza - 114.566</p>
                        <p>Sensei - 97.189</p>
                        <p>Torni - 122.252</p>
                        <p>Marcos - 999.999</p>
                      </div>
                    </div>
                  </div>
                </a>
              </li>

              <!-- <li class="notifications-block border-bottom pb-2 mb-2">
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="notifications-icon-wrap bg-info">
                                    <i class="notifications-icon bi-folder"></i>
                                </div>

                                <div>
                                    <span>Edu - 93.293</span>

                                    <p>10 days ago</p>
                                </div>
                            </a>
                        </li> -->

              <!-- <li class="notifications-block">
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="notifications-icon-wrap bg-danger">
                                    <i class="notifications-icon bi-question-circle"></i>
                                </div>

                                <div>
                                    <span>Account verification failed.</span>

                                    <p>1 hour ago</p>
                                </div>
                            </a>
                        </li> -->
            </ul>
          </div>

          <!-- <div class="dropdown ps-1">
                    <a class="nav-link dropdown-toggle text-center" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        <i class="bi-three-dots-vertical"></i>
                    </a>

                    <div class="dropdown-menu dropdown-menu-social bg-white shadow">
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-4">
                                    <a class="dropdown-item text-center" href="#">
                                        <img src="images/social/search.png" class="profile-image img-fluid" alt="">
                                        <span class="d-block">Google</span>
                                    </a>
                                </div>

                                <div class="col-lg-4 col-md-4 col-4">
                                    <a class="dropdown-item text-center" href="#">
                                        <img src="images/social/spotify.png" class="profile-image img-fluid" alt="">
                                        <span class="d-block">Spotify</span>
                                    </a>
                                </div>

                                <div class="col-lg-4 col-md-4 col-4">
                                    <a class="dropdown-item text-center" href="#">
                                        <img src="images/social/telegram.png" class="profile-image img-fluid" alt="">
                                        <span class="d-block">Telegram</span>
                                    </a>
                                </div>

                                <div class="col-lg-4 col-md-4 col-4">
                                    <a class="dropdown-item text-center" href="#">
                                        <img src="images/social/snapchat.png" class="profile-image img-fluid" alt="">
                                        <span class="d-block">Snapchat</span>
                                    </a>
                                </div>

                                <div class="col-lg-4 col-md-4 col-4">
                                    <a class="dropdown-item text-center" href="#">
                                        <img src="images/social/tiktok.png" class="profile-image img-fluid" alt="">
                                        <span class="d-block">Tiktok</span>
                                    </a>
                                </div>

                                <div class="col-lg-4 col-md-4 col-4">
                                    <a class="dropdown-item text-center" href="#">
                                        <img src="images/social/youtube.png" class="profile-image img-fluid" alt="">
                                        <span class="d-block">Youtube</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->

          <div class="dropdown px-3">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <img
                src="images/medium-shot-happy-man-smiling.jpg"
                class="profile-image img-fluid"
                alt=""
              />
            </a>
            <ul class="dropdown-menu bg-white shadow">
              <li>
                <div class="dropdown-menu-profile-thumb d-flex">
                  <img
                    src="images/medium-shot-happy-man-smiling.jpg"
                    class="profile-image img-fluid me-3"
                    alt=""
                  />

                  <div class="d-flex flex-column">
                    <small>Bolilla Negra</small>
                    <a href="#">hcdt-bolilla@gmail.com</a>
                  </div>
                </div>
              </li>

              <li>
                <a class="dropdown-item" href="login2.html?redirect=carga">
                  <i class="bi-person me-2"></i>
                  Exclusivo HCDT
                </a>
              </li>

              <li class="border-top mt-3 pt-2 mx-4">
                <a class="dropdown-item ms-0 me-0" href="#">
                  <i class="bi-box-arrow-left me-2"></i>
                  Logout
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <div class="container-fluid">
      <div class="row">
        <nav
          id="sidebarMenu"
          class="col-md-2 col-lg-2 d-md-block sidebar collapse"
        >
          <div class="position-sticky py-4 px-3 sidebar-sticky">
            <ul class="nav flex-column h-100">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="index.html">
                  <i class="bi-house-fill me-2"></i>
                  Inicio
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="wallet.html">
                  <i class="bi-wallet me-2"></i>
                  Resultados
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link active" href="jugadoranual.html">
                  <i class="bi-award-fill me-2"></i>
                  Jugador del Año
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="sociales.html">
                  <i class="bi-person me-2"></i>
                  Sociales
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="calendario26.html">
                  <i class="bi-calendar3 me-2"></i>
                  Calendario 2026
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="resumen25.html">
                  <i class="bi-trophy"></i>
                  Resultados 2025
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="resumen24.html">
                  <i class="bi-trophy"></i>
                  Resultados 2024
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="index2.html">
                  <i class="bi-gear me-2"></i>
                  Nuestra historia
                </a>
              </li>

              <!-- <li class="nav-item featured-box mt-lg-3 mt-2 mb-4">
                            <img src="images/tipito.jpeg" class="img-fluid" alt=""
                                style="width: 190px; height: 190px; vertical-align: middle">
                        </li> -->
            </ul>
          </div>
        </nav>

        <main
          class="main-wrapper col-md-10 ms-sm-auto py-4 col-lg-10 px-md-4 border-start"
        >
          <div class="title-group mb-3">
            <h1 class="h2 mb-0">Jugador del Año 2026</h1>
          </div>

          <div class="row my-4">
            <div class="col-lg-12 col-12">
              <div class="custom-block bg-white">
                <!-- <p class="mb-4">En esta sección se reflejará en forma dinámica la clasificación, según puntaje, para Jugador del Año.</p> -->
                <div class="table-responsive">
                  <table class="account-table table" id="tablaAnual">
                    <thead>
                      <tr>
                        <th scope="col">Pos</th>
                        <th scope="col">Player</th>
                        <th scope="col">Puntos</th>
                        <th scope="col">Birdies</th>
                        <th scope="col">Score Mes</th>
                        <!-- <th scope="col">Sierra</th> -->
                        <th scope="col">Córdoba</th>
                        <th scope="col">Apertura</th>
                        <th scope="col">Clausura</th>
                        <th scope="col">Cariló</th>
                        <!-- <th scope="col">Desafío</th> -->
                      </tr>
                    </thead>

                    <tbody>
                      <tr></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>

      <footer class="site-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-12 col-12">
              <p class="copyright-text">
                Copyright © Mini Finance 2048 - Design:
                <a
                  rel="sponsored"
                  href="https://www.tooplate.com"
                  target="_blank"
                  >Tooplate</a
                >
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- JAVASCRIPT FILES -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/apexcharts.min.js"></script>
    <script src="js/custom.js"></script>
    <!-- <script src="../js/anual.js"></script> -->

    <script>
      let año = "2025";
      let players2 = [];
      let giras = [];

      async function main() {
        const resultadosFull = await leerDatosNetos();
        if (!resultadosFull || resultadosFull.length === 0) {
          console.error(
            "No se obtuvieron datos de leerDatosNetos o están vacíos.",
          );
          return;
        }

        const resultados = resultadosFull.filter((r) => r.fec > 60);
        players2 = resultados.filter((r) => r.fec > 60);

        giras = await leerDatosGiras();
        const fechas = await leerDatosFechas();

        const berdis = await leeTablaBerdis();
        const mapaBerdies = totalizarPuntos(berdis || []);

        // ✅ CREO LA MATRIZ ACÁ (antes de usarla)
        let matrizValores = Array.from({ length: 12 }, () => [
          "",
          "",
          0,
          0,
          0,
          0,
          0,
          0,
          0,
        ]);

        // ================================
        // CARGA JUGADORES
        // ================================
        for (const player of players2) {
          if (player.play !== "Presi") {
            const textoBuscado = player.play;

            for (let i = 0; i < 12; i++) {
              if (matrizValores[i][1] == textoBuscado) {
                break;
              } else if (!matrizValores[i][1]) {
                matrizValores[i][1] = textoBuscado;
                break;
              }
            }
          }
        }

        // ================================
        // MEJOR SCORE MENSUAL
        // ================================
        const ganadoresScore = localStorage.getItem("ganadoresScore");

        if (ganadoresScore) {
          const matrizGanadoresScore = JSON.parse(ganadoresScore);

          matrizValores.forEach((fila) => (fila[4] = 0));

          matrizGanadoresScore.forEach((ganador) => {
            const player = ganador[0];
            const puntos = parseFloat(ganador[1]);

            for (let i = 0; i < 12; i++) {
              if (matrizValores[i][1] == player) {
                matrizValores[i][4] += puntos;
              }
            }
          });
        }

        // ================================
        // GIRAS
        // ================================
        for (const jugador of giras || []) {
          const textoBuscado = jugador.Jugador;

          for (let i = 0; i < 12; i++) {
            if (matrizValores[i][1] == textoBuscado) {
              matrizValores[i][5] = parseFloat(jugador.Cordoba) || 0;
              matrizValores[i][6] = parseFloat(jugador.Apertura) || 0;
              matrizValores[i][7] = parseFloat(jugador.Clausura) || 0;
              matrizValores[i][8] = parseFloat(jugador.Carilo) || 0;
              break;
            }
          }
        }

        // ================================
        // BERDIES (columna 3)
        // ================================
        agregarPuntosBerdies(matrizValores, mapaBerdies);

        // ================================
        // TOTAL GENERAL (columna 2)
        // ================================
        for (let i = 0; i < 12; i++) {
          matrizValores[i][2] = 0;

          for (let j = 3; j < 9; j++) {
            const valor = matrizValores[i][j];
            if (!isNaN(valor)) {
              matrizValores[i][2] += valor;
            }
          }
        }

        // ================================
        // ORDENAR
        // ================================
        matrizValores.sort((a, b) => parseFloat(b[2]) - parseFloat(a[2]));

        for (let i = 0; i < 12; i++) {
          matrizValores[i][0] = i + 1;
        }

        // ================================
        // RENDER TABLA
        // ================================
        const tablaAnual = document.getElementById("tablaAnual");
        const tbody = tablaAnual.querySelector("tbody");
        tbody.innerHTML = "";

        for (let i = 0; i < matrizValores.length; i++) {
          const fila = tbody.insertRow();

          for (let j = 0; j < matrizValores[i].length; j++) {
            const celda = fila.insertCell(j);

            if (j === 3) {
                const enlace = document.createElement("a");
                // enlace.href = `transation-detail.html?player=${encodeURIComponent(matrizValores[i][1])}`;
                enlace.textContent = matrizValores[i][j];
                celda.appendChild(enlace);
              } else {
              celda.textContent = matrizValores[i][j];
            }
          }
        }
      }

      // ================================
      // FUNCION BERDIES
      // ================================
      function agregarPuntosBerdies(matrizValores, mapaBerdies) {
        for (let i = 0; i < matrizValores.length; i++) {
          const nombreJugador = matrizValores[i][1];
          matrizValores[i][3] += mapaBerdies[nombreJugador] || 0;
        }
      }

      main();

      async function leerDatosNetos() {
        try {
          const response = await fetch(`/leerDatosNetos`);
          if (response.ok) {
            const resultados = await response.json();
            return resultados;
          } else {
            console.error(
              "Error en la respuesta:",
              response.status,
              response.statusText,
            );
            return null;
          }
        } catch (error) {
          console.error("Error en la solicitud:", error);
          return null;
        }
      }

      async function leerDatosFechas() {
        try {
          const response = await fetch(`/leerDatosFechas`);
          if (response.ok) {
            const fechas = await response.json();
            const fechasFiltradas = fechas.filter(
              (fecha) => fecha.fec > 60 && fecha.fec < 90,
            );

            return fechasFiltradas; // Devuelve las fechas filtradas con diaJugado
          } else {
            console.error(
              "Error en la respuesta:",
              response.status,
              response.statusText,
            );
            return null;
          }
        } catch (error) {
          console.error("Error en la solicitud:", error);
          return null;
        }
      }

      async function leerDatosGiras() {
        try {
          const results = await fetch(`/leerDatosGiras`);
          if (results.ok) {
            const resultadosGira = await results.json();
            return resultadosGira;
          } else {
            console.error(
              "Error en la respuesta:",
              results.status,
              results.statusText,
            );
            return null;
          }
        } catch (error) {
          console.error("Error en la solicitud lectura Gira:", error);
          return null;
        }
      }

      /* ::::::::::::::::::::::::::::::::::::::::::::::::::::::
        //   leeTablaBerdis 
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::*/
      async function leeTablaBerdis() {
        try {
          const response = await fetch(`/leerTablaBerdis`);
          if (response.ok) {
            const resultados = await response.json();

            // Validación explícita si viene vacío
            if (!Array.isArray(resultados)) {
              console.warn("Respuesta inesperada del servidor:", resultados);
              return null;
            }

            if (resultados.length === 0) {
              console.info("No hay registros disponibles en la tabla Berdis.");
              return []; // devuelve array vacío para seguir usando filter/map sin errores
            }

            return resultados; // datos válidos
          } else {
            console.error(
              "Error en la respuesta:",
              response.status,
              response.statusText,
            );
            return null;
          }
        } catch (error) {
          console.error("Error en la solicitud:", error);
          return null;
        }
      }

      function totalizarPuntos(berdies) {
        return berdies
          .filter((b) => b.fechakey > 60) // filtra
          .reduce((acc, b) => {
            if (!acc[b.jugador]) {
              acc[b.jugador] = 0;
            }
            acc[b.jugador] += b.puntos || 0;
            return acc;
          }, {});
      }
    </script>
  </body>
</html>
